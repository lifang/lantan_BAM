<script>
<% if controller.action_name=="search" %>
    $(document).ready(function(){
      $(".pageTurn a").unbind("click");
      $(".pageTurn a").bind("click", function() {
        var url = this.href + "&name="+$("#name").val()+"&types="+$("#s_types").val()+"&status="+$("#s_status").val();
        $.ajax({
          async:true,
          url:url,
          dataType:"script",
          type:"POST",
          success:function(){
            // alert(1);
          },error:function(){
            // alert("error");
          }
        });
        /* alert(this.href); */
        return false;
      });
    });
<% end %>
</script>
<div>
  <div class="table_box_h">
    <table width="100%" border="0" cellspacing="0" cellpadding="0" class="data_table" id="staffs_table">
      <thead>
        <tr class="hbg">
          <th><span class="sort_u_s" onclick="sort_change(this)">姓名</span></th>
          <th>工作岗位</th>
          <th>职务</th>
          <th><span>管理扣分</span></th>
          <th><span>得分</span></th>
          <th>状态</th>
          <th>本月评估</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        <% unless @staffs.blank? %>
          <% staff = @staffs[0] %>
          <tr>
            <td><%= staff.name %></td>
            <td><%= Staff::N_HEAD[staff.position] %></td>
            <td><%= Staff::N_COMPANY[staff.type_of_w] %></td>
              <% month_score =  @staff_scores_hash[staff.id] %>
            <td>
              <label class="sys_score_text"><%= month_score.nil? ? 0 : month_score.try(:sys_score) %></label>
            </td>
            <td class="manage_score_data"><%=100-(month_score.nil? ? 0 : month_score.try(:sys_score)) %></td>
            <td><%= Staff::STATUS_NAME[staff.status] %></td>
            <td class="assess_result"><%= current_month_access_result(month_score) %></td>
            <td>
              <% if permission?(:staffs,:detail_staff) %><%= link_to "详细", store_staff_path(@store, staff.id) %><% end %>
              <% if permission?(:staffs,:del_staff) %><%= link_to "删除", store_staff_path(@store, staff.id), :method => :delete, :confirm => "确定删除该员工吗？" %><% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <div class="table_box">
    <table width="100%" border="0" cellspacing="0" cellpadding="0" class="data_table" id="staffs_table">
      <thead>
        <tr class="hbg">
          <th><span class="sort_u_s" onclick="sort_change(this)">姓名</span></th>
          <th>工作岗位</th>
          <th>职务</th>
          <th><span>管理扣分</span></th>
          <th><span>得分</span></th>
          <th>状态</th>
          <th>本月评估</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        <% @staffs.each do |staff| %>
          <tr>
            <td><%= staff.name %></td>
            <td><%= Staff::N_HEAD[staff.position] %></td>
            <td><%= Staff::N_COMPANY[staff.type_of_w] %></td>
            <% month_score =  @staff_scores_hash[staff.id] %>
            <td>
              <label class="sys_score_text"><%= month_score.nil? ? 0 : month_score.try(:sys_score) %></label>
            </td>
            <td class="manage_score_data"><%=100-(month_score.nil? ? 0 : month_score.try(:sys_score)) %></td>
            <td><%= Staff::STATUS_NAME[staff.status] %></td>
            <td class="assess_result"><%= current_month_access_result(month_score) %></td>
            <td>
              <% if permission?(:staffs,:detail_staff) %><%= link_to "详细", store_staff_path(@store, staff.id) %><% end %>
              <% if permission?(:staffs,:del_staff) %><%= link_to "删除", store_staff_path(@store, staff.id), :method => :delete, :confirm => "确定删除该员工吗？" %><% end %>
            </td>
          </tr>
        <% end  unless @staffs.blank?%>
      </tbody>
    </table>
    <%= will_paginate @staffs, :class => "pageTurn", :previous_label => "上一页",
      :next_label => "下一页" unless @staffs.blank?%>
  </div>
</div>